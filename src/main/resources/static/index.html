<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Contas Banc√°rias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        } /* Bot√µes azuis: Buscar Conta, Atualizar Lista */

        .btn-success {
            background: #27ae60;
            color: white;
        } /* Bot√µes verdes: Criar Conta, Dep√≥sito, Salvar Altera√ß√µes */

        .btn-warning {
            background: #f39c12;
            color: white;
        } /* Bot√µes laranja: Limpar, Editar, Saque */

        .btn-danger {
            background: #e74c3c;
            color: white;
        } /* Bot√µes vermelhos: Excluir, Fechar, Cancelar */

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .contas-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .conta-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conta-item:last-child {
            border-bottom: none;
        }

        .conta-info {
            flex: 1;
        }

        .conta-titular {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .conta-saldo {
            font-size: 16px;
            color: #27ae60;
            font-weight: bold;
        }

        .conta-actions {
            display: flex;
            gap: 10px;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .extrato-container {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin: 10px 0;
            padding: 20px;
        }

        .extrato-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .operacoes-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .movimentacao-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }

        .movimentacao-item.deposito {
            background: #d4edda;
            border-left-color: #27ae60;
        }

        .movimentacao-item.saque {
            background: #f8d7da;
            border-left-color: #e74c3c;
        }

        .movimentacao-valor.deposito {
            color: #27ae60;
            font-weight: bold;
        }

        .edit-form {
            background: #f8f9fa;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            display: none;
        }

        .edit-form h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .edit-form .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .edit-form .form-group {
            flex: 1;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Sistema de Contas Banc√°rias</h1>
            <p>Gerencie suas contas de forma simples e eficiente</p>
        </div>

        <div class="content">
            <!-- Mensagens -->
            <div id="message" class="message" style="display: none;"></div>

            <!-- Formul√°rio para Nova Conta -->
            <div class="form-section">
                <h2>üìã Buscar Conta</h2>
                <form id="buscaForm">
                    <div class="form-group">
                        <label for="busca">Buscar por ID da Conta ou Nome do Cliente:</label>
                        <input type="text" id="busca" name="busca" placeholder="Digite o ID (ex: 1) ou nome do cliente">
                    </div>
                    <button type="submit" class="btn btn-primary">üîç Buscar Conta</button>
                    <button type="button" class="btn btn-warning" onclick="limparBusca()">üóëÔ∏è Limpar</button>
                </form>
                <div id="resultadoBusca" style="margin-top: 20px; display: none;"></div>
            </div>

            <!-- Formul√°rio para Nova Conta -->
            <div class="form-section">
                <h2>üìù Nova Conta</h2>
                <form id="contaForm">
                    <div class="form-group">
                        <label for="nome">Nome Completo:</label>
                        <input type="text" id="nome" name="nome" required placeholder="Digite o nome completo">
                    </div>
                    <div class="form-group">
                        <label for="cpf">CPF (apenas n√∫meros):</label>
                        <input type="text" id="cpf" name="cpf" required placeholder="12345678901" maxlength="11"
                            pattern="[0-9]{11}">
                    </div>
                    <div class="form-group">
                        <label for="saldo">Saldo Inicial:</label>
                        <input type="number" id="saldo" name="saldo" step="0.01" min="0" required placeholder="0.00">
                    </div>
                    <button type="submit" class="btn btn-success">üí∞ Criar Conta</button>
                    <button type="button" class="btn btn-primary" onclick="listarContas()">üîÑ Atualizar Lista</button>
                </form>
            </div>

            <!-- Lista de Contas -->
            <div class="form-section">
                <h2>üìã Contas Cadastradas</h2>
                <div id="contasList" class="contas-list">
                    <div class="loading">Carregando contas...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URL base da API
        const API_BASE = 'http://localhost:8080/contas';

        // Fun√ß√£o para mostrar mensagens
        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Fun√ß√£o para buscar conta
        document.getElementById('buscaForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const termoBusca = document.getElementById('busca').value.trim();
            if (!termoBusca) {
                alert('Digite um ID ou nome para buscar');
                return;
            }

            const resultadoDiv = document.getElementById('resultadoBusca');

            // Verificar se √© um n√∫mero (ID) ou texto (nome)
            if (/^\d+$/.test(termoBusca)) {
                // Buscar por ID
                await buscarPorId(parseInt(termoBusca), resultadoDiv);
            } else {
                // Buscar por nome nas contas listadas
                await buscarPorNome(termoBusca, resultadoDiv);
            }
        });

        // Fun√ß√£o para buscar conta por ID
        async function buscarPorId(id, resultadoDiv) {
            try {
                const response = await fetch(`${API_BASE}/${id}`);

                if (response.ok) {
                    const conta = await response.json();
                    exibirResultadoBusca([conta], resultadoDiv, `Conta encontrada (ID: ${id})`);
                } else {
                    resultadoDiv.innerHTML = `
                        <div class="message error">
                            Conta com ID ${id} n√£o encontrada
                        </div>
                    `;
                    resultadoDiv.style.display = 'block';
                }
            } catch (error) {
                resultadoDiv.innerHTML = `
                    <div class="message error">
                        Erro ao buscar conta: ${error.message}
                    </div>
                `;
                resultadoDiv.style.display = 'block';
            }
        }

        // Fun√ß√£o para buscar conta por nome
        async function buscarPorNome(nome, resultadoDiv) {
            try {
                const response = await fetch(API_BASE);
                const todasContas = await response.json();

                const contasEncontradas = todasContas.filter(conta =>
                    conta.titular.toLowerCase().includes(nome.toLowerCase())
                );

                if (contasEncontradas.length > 0) {
                    exibirResultadoBusca(contasEncontradas, resultadoDiv, `${contasEncontradas.length} conta(s) encontrada(s) para "${nome}"`);
                } else {
                    resultadoDiv.innerHTML = `
                        <div class="message error">
                            Nenhuma conta encontrada para "${nome}"
                        </div>
                    `;
                    resultadoDiv.style.display = 'block';
                }
            } catch (error) {
                resultadoDiv.innerHTML = `
                    <div class="message error">
                        Erro ao buscar contas: ${error.message}
                    </div>
                `;
                resultadoDiv.style.display = 'block';
            }
        }

        // Fun√ß√£o para exibir resultado da busca
        function exibirResultadoBusca(contas, resultadoDiv, titulo) {
            resultadoDiv.innerHTML = `
                <div class="message success">${titulo}</div>
                <div class="contas-list">
                    ${contas.map(conta => `
                        <div class="conta-item">
                            <div class="conta-info">
                                <div class="conta-titular">üè¶ ID: ${conta.id} | üë§ ${conta.titular}</div>
                                <div class="conta-saldo">üí∞ R$ ${conta.saldo.toFixed(2)}</div>
                            </div>
                            <div class="conta-actions">
                                <button class="btn btn-info" onclick="verExtratoBusca(${conta.id})">üìã Extrato</button>
                                <button class="btn btn-warning" onclick="toggleEditarContaBusca(${conta.id}, '${conta.titular}', ${conta.saldo})">‚úèÔ∏è Editar</button>
                                <button class="btn btn-danger" onclick="excluirContaBusca(${conta.id})">üóëÔ∏è Excluir</button>
                            </div>
                        </div>
                        <div id="edit-busca-${conta.id}" class="edit-form">
                            <h4>‚úèÔ∏è Editar Conta ID: ${conta.id}</h4>
                            <form id="editFormBusca-${conta.id}">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editNomeBusca-${conta.id}">Nome Completo:</label>
                                        <input type="text" id="editNomeBusca-${conta.id}" required placeholder="Digite o nome completo">
                                    </div>
                                    <div class="form-group">
                                        <label for="editSaldoBusca-${conta.id}">Saldo:</label>
                                        <input type="number" id="editSaldoBusca-${conta.id}" step="0.01" min="0" required placeholder="0.00">
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button type="submit" class="btn btn-success">‚úîÔ∏è Salvar Altera√ß√µes</button>
                                    <button type="button" class="btn btn-danger" onclick="cancelarEdicaoBusca(${conta.id})">‚ùå Cancelar</button>
                                </div>
                            </form>
                        </div>
                        <div id="extrato-busca-${conta.id}" class="extrato-container" style="display: none;"></div>
                    `).join('')}
                </div>
            `;
            resultadoDiv.style.display = 'block';
        }

        // Fun√ß√£o para limpar busca
        function limparBusca() {
            document.getElementById('busca').value = '';
            document.getElementById('resultadoBusca').style.display = 'none';
        }

        // Fun√ß√µes espec√≠ficas para resultados de busca
        function toggleEditarContaBusca(id, titular, saldo) {
            const editForm = document.getElementById(`edit-busca-${id}`);

            if (editForm.style.display === 'none' || editForm.style.display === '') {
                // Extrair apenas o nome (remover CPF)
                let nomeAtual = titular;
                if (nomeAtual.includes('(CPF:')) {
                    nomeAtual = nomeAtual.substring(0, nomeAtual.indexOf('(CPF:')).trim();
                }

                // Preencher campos
                document.getElementById(`editNomeBusca-${id}`).value = nomeAtual;
                document.getElementById(`editSaldoBusca-${id}`).value = saldo;

                // Mostrar formul√°rio
                editForm.style.display = 'block';

                // Adicionar evento de submit
                const form = document.getElementById(`editFormBusca-${id}`);
                form.onsubmit = (e) => {
                    e.preventDefault();
                    salvarEdicaoBusca(id);
                };
            } else {
                editForm.style.display = 'none';
            }
        }

        async function salvarEdicaoBusca(id) {
            const nome = document.getElementById(`editNomeBusca-${id}`).value.trim();
            const saldo = parseFloat(document.getElementById(`editSaldoBusca-${id}`).value);

            if (!nome || isNaN(saldo) || saldo < 0) {
                alert('Nome n√£o pode ser vazio e saldo deve ser um n√∫mero v√°lido >= 0');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ titular: nome, saldo: saldo })
                });

                if (response.ok) {
                    showMessage('Conta atualizada com sucesso!', 'success');
                    cancelarEdicaoBusca(id);
                    listarContas();
                    // Refazer a busca para atualizar resultado
                    const termoBusca = document.getElementById('busca').value.trim();
                    if (termoBusca) {
                        document.getElementById('buscaForm').dispatchEvent(new Event('submit'));
                    }
                } else {
                    const error = await response.text();
                    alert('Erro ao atualizar conta: ' + error);
                }
            } catch (error) {
                alert('Erro ao atualizar conta: ' + error.message);
            }
        }

        function cancelarEdicaoBusca(id) {
            document.getElementById(`edit-busca-${id}`).style.display = 'none';
        }

        function verExtratoBusca(idConta) {
            const extratoDiv = document.getElementById(`extrato-busca-${idConta}`);

            if (extratoDiv.style.display === 'none') {
                // Gerar extrato espec√≠fico para busca
                gerarExtratoBusca(idConta, extratoDiv);
            } else {
                extratoDiv.style.display = 'none';
            }
        }

        async function gerarExtratoBusca(idConta, extratoDiv) {
            try {
                // Buscar dados da conta para mostrar saldo atual
                const contaResponse = await fetch(`${API_BASE}/${idConta}`);
                const conta = await contaResponse.json();

                const response = await fetch(`${API_BASE}/${idConta}/extrato`);
                const movimentacoes = await response.json();

                extratoDiv.innerHTML = `
                    <div class="extrato-header">
                        <h3>üìã Extrato da Conta</h3>
                        <button class="btn btn-danger" onclick="fecharExtratoBusca(${idConta})">‚ùå Fechar</button>
                    </div>
                    <div class="operacoes-buttons">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <button class="btn btn-success" onclick="realizarDepositoBusca(${idConta})">üí∞ Dep√≥sito</button>
                                <button class="btn btn-warning" onclick="realizarSaqueBusca(${idConta})">üíµ Saque</button>
                            </div>
                            <div style="font-size: 18px; font-weight: bold; color: #27ae60;">
                                üí∞ Saldo Atual: R$ ${conta.saldo.toFixed(2)}
                            </div>
                        </div>
                    </div>
                    <div class="movimentacoes-lista">
                        ${movimentacoes.length === 0 ?
                        '<p>Nenhuma movimenta√ß√£o encontrada</p>' :
                        movimentacoes.map(mov => `
                                <div class="movimentacao-item ${mov.tipo.toLowerCase()}">
                                    <div>
                                        <strong>${mov.tipo}</strong><br>
                                        <small>${new Date(mov.dataMovimentacao).toLocaleString('pt-BR')}</small>
                                    </div>
                                    <div class="movimentacao-valor ${mov.tipo.toLowerCase()}">
                                        ${mov.tipo === 'DEPOSITO' ? '+' : '-'} R$ ${mov.valor.toFixed(2)}
                                    </div>
                                </div>
                            `).join('')
                    }
                    </div>
                `;
                extratoDiv.style.display = 'block';
            } catch (error) {
                showMessage('Erro ao carregar extrato: ' + error.message, 'error');
            }
        }

        function fecharExtratoBusca(idConta) {
            document.getElementById(`extrato-busca-${idConta}`).style.display = 'none';
        }

        async function realizarDepositoBusca(idConta) {
            const valor = prompt('Valor do dep√≥sito:');
            if (valor && !isNaN(valor) && parseFloat(valor) > 0) {
                try {
                    const response = await fetch(`${API_BASE}/${idConta}/deposito`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tipo: 'DEPOSITO', valor: parseFloat(valor) })
                    });

                    if (response.ok) {
                        showMessage('Dep√≥sito realizado com sucesso!', 'success');
                        atualizarExtratoBusca(idConta); // Atualizar extrato sem fechar
                        atualizarSaldoNaBusca(idConta); // Atualizar saldo na busca
                    } else {
                        const error = await response.text();
                        alert(error);
                    }
                } catch (error) {
                    alert('Erro no dep√≥sito: ' + error.message);
                }
            } else if (valor !== null) {
                alert('Valor inv√°lido para dep√≥sito');
            }
        }

        async function realizarSaqueBusca(idConta) {
            const valor = prompt('Valor do saque:');
            if (valor && !isNaN(valor) && parseFloat(valor) > 0) {
                try {
                    const response = await fetch(`${API_BASE}/${idConta}/saque`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tipo: 'SAQUE', valor: parseFloat(valor) })
                    });

                    if (response.ok) {
                        showMessage('Saque realizado com sucesso!', 'success');
                        atualizarExtratoBusca(idConta); // Atualizar extrato sem fechar
                        atualizarSaldoNaBusca(idConta); // Atualizar saldo na busca
                    } else {
                        const error = await response.text();
                        alert(error);
                    }
                } catch (error) {
                    alert('Erro no saque: ' + error.message);
                }
            } else if (valor !== null) {
                alert('Valor inv√°lido para saque');
            }
        }

        // Fun√ß√£o para atualizar saldo na busca
        async function atualizarSaldoNaBusca(idConta) {
            try {
                const response = await fetch(`${API_BASE}/${idConta}`);
                const conta = await response.json();

                // Atualizar saldo na busca
                const saldoElement = document.querySelector(`#resultadoBusca .conta-item:has(button[onclick*="verExtratoBusca(${idConta})"]`).querySelector('.conta-saldo');
                if (saldoElement) {
                    saldoElement.textContent = `üí∞ R$ ${conta.saldo.toFixed(2)}`;
                }
            } catch (error) {
                console.error('Erro ao atualizar saldo na busca:', error);
            }
        }

        async function excluirContaBusca(id) {
            if (confirm('Tem certeza que deseja excluir esta conta?')) {
                try {
                    const response = await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });

                    if (response.ok) {
                        showMessage('Conta exclu√≠da com sucesso!', 'success');
                        listarContas();
                        limparBusca(); // Limpar resultado da busca
                    } else {
                        const error = await response.text();
                        alert('Erro ao excluir conta: ' + error);
                    }
                } catch (error) {
                    alert('Erro ao excluir conta: ' + error.message);
                }
            }
        }

        // Fun√ß√£o para listar todas as contas
        async function listarContas() {
            try {
                const response = await fetch(API_BASE);
                const contas = await response.json();

                const contasList = document.getElementById('contasList');

                if (contas.length === 0) {
                    contasList.innerHTML = '<div class="loading">Nenhuma conta cadastrada</div>';
                    return;
                }

                contasList.innerHTML = contas.map(conta => `
                    <div class="conta-item">
                        <div class="conta-info">
                            <div class="conta-titular">üè¶ ID: ${conta.id} | üë§ ${conta.titular}</div>
                            <div class="conta-saldo">üí∞ R$ ${conta.saldo.toFixed(2)}</div>
                        </div>
                        <div class="conta-actions">
                            <button class="btn btn-info" onclick="verExtrato(${conta.id})">üìã Extrato</button>
                            <button class="btn btn-warning" onclick="toggleEditarConta(${conta.id}, '${conta.titular}', ${conta.saldo})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="excluirConta(${conta.id})">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                    <div id="edit-${conta.id}" class="edit-form">
                        <h4>‚úèÔ∏è Editar Conta ID: ${conta.id}</h4>
                        <form id="editForm-${conta.id}">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="editNome-${conta.id}">Nome Completo:</label>
                                    <input type="text" id="editNome-${conta.id}" required placeholder="Digite o nome completo">
                                </div>
                                <div class="form-group">
                                    <label for="editSaldo-${conta.id}">Saldo:</label>
                                    <input type="number" id="editSaldo-${conta.id}" step="0.01" min="0" required placeholder="0.00">
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button type="submit" class="btn btn-success">‚úîÔ∏è Salvar Altera√ß√µes</button>
                                <button type="button" class="btn btn-danger" onclick="cancelarEdicao(${conta.id})">‚ùå Cancelar</button>
                            </div>
                        </form>
                    </div>
                    <div id="extrato-${conta.id}" class="extrato-container" style="display: none;"></div>
                `).join('');

            } catch (error) {
                showMessage('Erro ao carregar contas: ' + error.message, 'error');
                document.getElementById('contasList').innerHTML = '<div class="loading">Erro ao carregar contas</div>';
            }
        }

        // Fun√ß√£o para criar nova conta
        document.getElementById('contaForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const nome = document.getElementById('nome').value;
            const cpf = document.getElementById('cpf').value;
            const saldo = parseFloat(document.getElementById('saldo').value);

            // Validar CPF (apenas n√∫meros, 11 d√≠gitos)
            if (!/^[0-9]{11}$/.test(cpf)) {
                showMessage('CPF deve conter exatamente 11 d√≠gitos num√©ricos', 'error');
                return;
            }

            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ nome, cpf, saldo })
                });

                if (response.ok) {
                    showMessage('Conta criada com sucesso!', 'success');
                    document.getElementById('contaForm').reset();
                    listarContas();
                } else {
                    const error = await response.text();
                    showMessage('Erro ao criar conta: ' + error, 'error');
                }
            } catch (error) {
                showMessage('Erro ao criar conta: ' + error.message, 'error');
            }
        });

        // Fun√ß√£o para mostrar/ocultar formul√°rio de edi√ß√£o
        function toggleEditarConta(id, titular, saldo) {
            const editForm = document.getElementById(`edit-${id}`);

            if (editForm.style.display === 'none' || editForm.style.display === '') {
                // Fechar outros formul√°rios de edi√ß√£o abertos
                document.querySelectorAll('.edit-form').forEach(form => {
                    form.style.display = 'none';
                });

                // Extrair apenas o nome (remover CPF)
                let nomeAtual = titular;
                if (nomeAtual.includes('(CPF:')) {
                    nomeAtual = nomeAtual.substring(0, nomeAtual.indexOf('(CPF:')).trim();
                }

                // Preencher campos
                document.getElementById(`editNome-${id}`).value = nomeAtual;
                document.getElementById(`editSaldo-${id}`).value = saldo;

                // Mostrar formul√°rio
                editForm.style.display = 'block';

                // Adicionar evento de submit
                const form = document.getElementById(`editForm-${id}`);
                form.onsubmit = (e) => {
                    e.preventDefault();
                    salvarEdicao(id);
                };
            } else {
                editForm.style.display = 'none';
            }
        }

        // Fun√ß√£o para salvar edi√ß√£o
        async function salvarEdicao(id) {
            const nome = document.getElementById(`editNome-${id}`).value.trim();
            const saldo = parseFloat(document.getElementById(`editSaldo-${id}`).value);

            if (!nome || isNaN(saldo) || saldo < 0) {
                alert('Nome n√£o pode ser vazio e saldo deve ser um n√∫mero v√°lido >= 0');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ titular: nome, saldo: saldo })
                });

                if (response.ok) {
                    showMessage('Conta atualizada com sucesso!', 'success');
                    cancelarEdicao(id);
                    listarContas();
                } else {
                    const error = await response.text();
                    alert('Erro ao atualizar conta: ' + error);
                }
            } catch (error) {
                alert('Erro ao atualizar conta: ' + error.message);
            }
        }

        // Fun√ß√£o para cancelar edi√ß√£o
        function cancelarEdicao(id) {
            document.getElementById(`edit-${id}`).style.display = 'none';
        }

        // Fun√ß√£o para editar conta (manter compatibilidade)
        function editarConta(id, titular, saldo) {
            // Redirecionar para nova fun√ß√£o
            toggleEditarConta(id, titular, saldo);
        }

        // Fun√ß√£o para atualizar conta
        async function atualizarConta(id, titular, saldo) {
            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ titular, saldo })
                });

                if (response.ok) {
                    showMessage('Conta atualizada com sucesso!', 'success');
                    listarContas();
                } else {
                    const error = await response.text();
                    showMessage('Erro ao atualizar conta: ' + error, 'error');
                }
            } catch (error) {
                showMessage('Erro ao atualizar conta: ' + error.message, 'error');
            }
        }

        // Fun√ß√£o para excluir conta
        async function excluirConta(id) {
            if (confirm('Tem certeza que deseja excluir esta conta?')) {
                try {
                    const response = await fetch(`${API_BASE}/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        showMessage('Conta exclu√≠da com sucesso!', 'success');
                        listarContas();
                    } else {
                        const error = await response.text();
                        showMessage('Erro ao excluir conta: ' + error, 'error');
                    }
                } catch (error) {
                    showMessage('Erro ao excluir conta: ' + error.message, 'error');
                }
            }
        }

        // Fun√ß√£o para ver extrato
        async function verExtrato(idConta) {
            const extratoDiv = document.getElementById(`extrato-${idConta}`);

            if (extratoDiv.style.display === 'none') {
                try {
                    // Buscar dados da conta para mostrar saldo atual
                    const contaResponse = await fetch(`${API_BASE}/${idConta}`);
                    const conta = await contaResponse.json();

                    const response = await fetch(`${API_BASE}/${idConta}/extrato`);
                    const movimentacoes = await response.json();

                    extratoDiv.innerHTML = `
                        <div class="extrato-header">
                            <h3>üìã Extrato da Conta</h3>
                            <button class="btn btn-danger" onclick="fecharExtrato(${idConta})">‚ùå Fechar</button>
                        </div>
                        <div class="operacoes-buttons">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <button class="btn btn-success" onclick="realizarDeposito(${idConta})">üí∞ Dep√≥sito</button>
                                    <button class="btn btn-warning" onclick="realizarSaque(${idConta})">üíµ Saque</button>
                                </div>
                                <div style="font-size: 18px; font-weight: bold; color: #27ae60;">
                                    üí∞ Saldo Atual: R$ ${conta.saldo.toFixed(2)}
                                </div>
                            </div>
                        </div>
                        <div class="movimentacoes-lista">
                            ${movimentacoes.length === 0 ?
                            '<p>Nenhuma movimenta√ß√£o encontrada</p>' :
                            movimentacoes.map(mov => `
                                    <div class="movimentacao-item ${mov.tipo.toLowerCase()}">
                                        <div>
                                            <strong>${mov.tipo}</strong><br>
                                            <small>${new Date(mov.dataMovimentacao).toLocaleString('pt-BR')}</small>
                                        </div>
                                        <div class="movimentacao-valor ${mov.tipo.toLowerCase()}">
                                            ${mov.tipo === 'DEPOSITO' ? '+' : '-'} R$ ${mov.valor.toFixed(2)}
                                        </div>
                                    </div>
                                `).join('')
                        }
                        </div>
                    `;
                    extratoDiv.style.display = 'block';
                } catch (error) {
                    showMessage('Erro ao carregar extrato: ' + error.message, 'error');
                }
            } else {
                extratoDiv.style.display = 'none';
            }
        }

        // Fun√ß√£o para fechar extrato
        function fecharExtrato(idConta) {
            document.getElementById(`extrato-${idConta}`).style.display = 'none';
        }

        // Fun√ß√£o para atualizar extrato sem fechar
        async function atualizarExtrato(idConta) {
            const extratoDiv = document.getElementById(`extrato-${idConta}`);
            if (extratoDiv && extratoDiv.style.display === 'block') {
                try {
                    // Buscar dados da conta para mostrar saldo atual
                    const contaResponse = await fetch(`${API_BASE}/${idConta}`);
                    const conta = await contaResponse.json();

                    const response = await fetch(`${API_BASE}/${idConta}/extrato`);
                    const movimentacoes = await response.json();

                    extratoDiv.innerHTML = `
                        <div class="extrato-header">
                            <h3>üìã Extrato da Conta</h3>
                            <button class="btn btn-danger" onclick="fecharExtrato(${idConta})">‚ùå Fechar</button>
                        </div>
                        <div class="operacoes-buttons">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <button class="btn btn-success" onclick="realizarDeposito(${idConta})">üí∞ Dep√≥sito</button>
                                    <button class="btn btn-warning" onclick="realizarSaque(${idConta})">üíµ Saque</button>
                                </div>
                                <div style="font-size: 18px; font-weight: bold; color: #27ae60;">
                                    üí∞ Saldo Atual: R$ ${conta.saldo.toFixed(2)}
                                </div>
                            </div>
                        </div>
                        <div class="movimentacoes-lista">
                            ${movimentacoes.length === 0 ?
                            '<p>Nenhuma movimenta√ß√£o encontrada</p>' :
                            movimentacoes.map(mov => `
                                    <div class="movimentacao-item ${mov.tipo.toLowerCase()}">
                                        <div>
                                            <strong>${mov.tipo}</strong><br>
                                            <small>${new Date(mov.dataMovimentacao).toLocaleString('pt-BR')}</small>
                                        </div>
                                        <div class="movimentacao-valor ${mov.tipo.toLowerCase()}">
                                            ${mov.tipo === 'DEPOSITO' ? '+' : '-'} R$ ${mov.valor.toFixed(2)}
                                        </div>
                                    </div>
                                `).join('')
                        }
                        </div>
                    `;
                } catch (error) {
                    showMessage('Erro ao atualizar extrato: ' + error.message, 'error');
                }
            }
        }

        // Fun√ß√£o para atualizar extrato da busca sem fechar
        async function atualizarExtratoBusca(idConta) {
            const extratoDiv = document.getElementById(`extrato-busca-${idConta}`);
            if (extratoDiv && extratoDiv.style.display === 'block') {
                await gerarExtratoBusca(idConta, extratoDiv);
            }
        }

        // Fun√ß√£o para realizar dep√≥sito
        async function realizarDeposito(idConta) {
            const valor = prompt('Valor do dep√≥sito:');
            if (valor && !isNaN(valor) && parseFloat(valor) > 0) {
                try {
                    const response = await fetch(`${API_BASE}/${idConta}/deposito`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tipo: 'DEPOSITO', valor: parseFloat(valor) })
                    });

                    if (response.ok) {
                        showMessage('Dep√≥sito realizado com sucesso!', 'success');
                        atualizarExtrato(idConta); // Atualizar extrato sem fechar
                        atualizarSaldoNaLista(idConta); // Atualizar apenas o saldo na lista
                    } else {
                        const error = await response.text();
                        alert(error);
                    }
                } catch (error) {
                    alert('Erro no dep√≥sito: ' + error.message);
                }
            } else if (valor !== null) {
                alert('Valor inv√°lido para dep√≥sito');
            }
        }

        // Fun√ß√£o para realizar saque
        async function realizarSaque(idConta) {
            const valor = prompt('Valor do saque:');
            if (valor && !isNaN(valor) && parseFloat(valor) > 0) {
                try {
                    const response = await fetch(`${API_BASE}/${idConta}/saque`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tipo: 'SAQUE', valor: parseFloat(valor) })
                    });

                    if (response.ok) {
                        showMessage('Saque realizado com sucesso!', 'success');
                        atualizarExtrato(idConta); // Atualizar extrato sem fechar
                        atualizarSaldoNaLista(idConta); // Atualizar apenas o saldo na lista
                    } else {
                        const error = await response.text();
                        alert(error);
                    }
                } catch (error) {
                    alert('Erro no saque: ' + error.message);
                }
            } else if (valor !== null) {
                alert('Valor inv√°lido para saque');
            }
        }

        // Fun√ß√£o para atualizar apenas o saldo na lista sem recriar HTML
        async function atualizarSaldoNaLista(idConta) {
            try {
                const response = await fetch(`${API_BASE}/${idConta}`);
                const conta = await response.json();

                // Atualizar saldo na lista principal
                const saldoElement = document.querySelector(`#contasList .conta-item:has(button[onclick*="verExtrato(${idConta})"]`).querySelector('.conta-saldo');
                if (saldoElement) {
                    saldoElement.textContent = `üí∞ R$ ${conta.saldo.toFixed(2)}`;
                }
            } catch (error) {
                console.error('Erro ao atualizar saldo:', error);
            }
        }

        // Carregar contas ao inicializar a p√°gina
        document.addEventListener('DOMContentLoaded', listarContas);
    </script>
</body>

</html>
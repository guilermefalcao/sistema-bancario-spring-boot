<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Completo - Sistema JWT Authentication</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        h3 {
            color: #495057;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #6c757d;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .step {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .flow-diagram {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.2;
            white-space: pre;
            overflow-x: auto;
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            margin: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .checklist li:before {
            content: "âœ…";
            position: absolute;
            left: 0;
        }

        .toc {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin: 5px 0;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” GUIA COMPLETO</h1>
            <p>Sistema de Contas BancÃ¡rias com JWT Authentication</p>
            <p><strong>Spring Boot 3.3.8 + Spring Security + Oracle Database</strong></p>
        </div>

        <div class="content">
            <!-- ÃNDICE -->
            <div class="toc">
                <h2>ğŸ“‹ ÃNDICE</h2>
                <ul>
                    <li><a href="#visao-geral">1. VisÃ£o Geral do Projeto</a></li>
                    <li><a href="#funcionamento-jwt">2. Como Funciona o JWT</a></li>
                    <li><a href="#arquitetura">3. Arquitetura da AplicaÃ§Ã£o</a></li>
                    <li><a href="#implementacao">4. ImplementaÃ§Ã£o Passo a Passo</a></li>
                    <li><a href="#testes-insomnia">5. Testes com Insomnia</a></li>
                    <li><a href="#tratamento-erros">6. Tratamento de Erros</a></li>
                    <li><a href="#seguranca">7. Aspectos de SeguranÃ§a</a></li>
                </ul>
            </div>

            <!-- VISÃƒO GERAL -->
            <div class="section" id="visao-geral">
                <h2>ğŸ¯ 1. VISÃƒO GERAL DO PROJETO</h2>
                
                <h3>Objetivo</h3>
                <p>Desenvolver um sistema bancÃ¡rio completo com autenticaÃ§Ã£o JWT (JSON Web Token), permitindo:</p>
                <ul class="checklist">
                    <li>Login seguro com usuÃ¡rio e senha</li>
                    <li>GeraÃ§Ã£o de tokens JWT para autenticaÃ§Ã£o</li>
                    <li>ProteÃ§Ã£o de rotas da API</li>
                    <li>GestÃ£o completa de contas bancÃ¡rias</li>
                    <li>Interface web responsiva</li>
                </ul>

                <h3>Tecnologias Utilizadas</h3>
                <div class="info-box">
                    <h4>Backend</h4>
                    <ul>
                        <li><strong>Spring Boot 3.3.8</strong> - Framework principal</li>
                        <li><strong>Spring Security 6</strong> - AutenticaÃ§Ã£o e autorizaÃ§Ã£o</li>
                        <li><strong>JWT (Auth0)</strong> - Tokens de autenticaÃ§Ã£o</li>
                        <li><strong>Spring Data JPA</strong> - PersistÃªncia de dados</li>
                        <li><strong>Oracle Database</strong> - Banco de dados</li>
                        <li><strong>BCrypt</strong> - Criptografia de senhas</li>
                    </ul>

                    <h4>Frontend</h4>
                    <ul>
                        <li><strong>HTML5/CSS3</strong> - Interface responsiva</li>
                        <li><strong>JavaScript ES6</strong> - LÃ³gica do frontend</li>
                        <li><strong>Fetch API</strong> - ComunicaÃ§Ã£o com backend</li>
                    </ul>
                </div>
            </div>

            <!-- FUNCIONAMENTO JWT -->
            <div class="section" id="funcionamento-jwt">
                <h2>ğŸ”‘ 2. COMO FUNCIONA O JWT</h2>
                
                <h3>O que Ã© JWT?</h3>
                <p>JWT (JSON Web Token) Ã© um padrÃ£o aberto (RFC 7519) que define uma forma compacta e segura de transmitir informaÃ§Ãµes entre partes como um objeto JSON.</p>

                <h3>Estrutura do Token JWT</h3>
                <div class="code-block">
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY0MjY4NjQwMCwiZXhwIjoxNjQyNjkzNjAwfQ.signature
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAYLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€ SIGNATURE â”€â”‚
                </div>

                <h4>1. Header (CabeÃ§alho)</h4>
                <div class="code-block">
{
  "alg": "HS256",    // Algoritmo de assinatura
  "typ": "JWT"       // Tipo do token
}
                </div>

                <h4>2. Payload (Dados)</h4>
                <div class="code-block">
{
  "sub": "admin",              // Subject (usuÃ¡rio)
  "iss": "API Conta BancÃ¡ria", // Issuer (emissor)
  "iat": 1642686400,          // Issued At (emitido em)
  "exp": 1642693600,          // Expiration (expira em)
  "userId": 1                 // Dados customizados
}
                </div>

                <h4>3. Signature (Assinatura)</h4>
                <div class="code-block">
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret
)
                </div>

                <h3>Fluxo de AutenticaÃ§Ã£o JWT</h3>
                <div class="flow-diagram">
1. ğŸ‘¤ USUÃRIO faz login com credenciais
   â†“
2. ğŸ” SERVIDOR valida credenciais no banco
   â†“
3. âœ… Se vÃ¡lidas: gera TOKEN JWT
   â†“
4. ğŸ“± CLIENTE armazena token (localStorage)
   â†“
5. ğŸ”„ CLIENTE envia token em todas as requisiÃ§Ãµes
   â†“
6. ğŸ›¡ï¸ SERVIDOR valida token a cada requisiÃ§Ã£o
   â†“
7. âœ… Se vÃ¡lido: permite acesso ao recurso
                </div>

                <h3>Vantagens do JWT</h3>
                <ul class="checklist">
                    <li><strong>Stateless:</strong> Servidor nÃ£o precisa armazenar sessÃµes</li>
                    <li><strong>EscalÃ¡vel:</strong> Funciona em mÃºltiplos servidores</li>
                    <li><strong>Seguro:</strong> Assinatura digital garante integridade</li>
                    <li><strong>Compacto:</strong> Pode ser enviado via URL, POST ou HTTP Header</li>
                    <li><strong>Auto-contido:</strong> ContÃ©m todas as informaÃ§Ãµes necessÃ¡rias</li>
                </ul>
            </div>

            <!-- ARQUITETURA -->
            <div class="section" id="arquitetura">
                <h2>ğŸ—ï¸ 3. ARQUITETURA DA APLICAÃ‡ÃƒO</h2>
                
                <h3>Camadas da AplicaÃ§Ã£o</h3>
                <div class="flow-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ login.html  â”‚  â”‚ index.html  â”‚  â”‚   auth.js   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              SECURITY LAYER                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚SecurityFilterâ”‚  â”‚TokenService â”‚  â”‚SecurityConfigâ”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              CONTROLLER LAYER                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚â”‚
â”‚  â”‚  â”‚ContaControllerâ”‚ â”‚AuthControllerâ”‚                 â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚               SERVICE LAYER                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚â”‚
â”‚  â”‚  â”‚ContaService â”‚  â”‚AuthService  â”‚                  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              REPOSITORY LAYER                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ContaRepo    â”‚  â”‚ClienteRepo  â”‚  â”‚UsuarioRepo  â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ JDBC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ORACLE DATABASE                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   usuarios  â”‚  â”‚   clientes  â”‚  â”‚    contas   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>

                <h3>Componentes Principais</h3>
                
                <h4>ğŸ” Camada de SeguranÃ§a</h4>
                <ul>
                    <li><strong>SecurityFilter:</strong> Intercepta requisiÃ§Ãµes e valida tokens</li>
                    <li><strong>TokenService:</strong> Gera e valida tokens JWT</li>
                    <li><strong>SecurityConfigurations:</strong> Configura regras de seguranÃ§a</li>
                    <li><strong>AutenticacaoService:</strong> Carrega dados do usuÃ¡rio</li>
                </ul>

                <h4>ğŸ® Camada de Controle</h4>
                <ul>
                    <li><strong>AutenticacaoController:</strong> Endpoint de login</li>
                    <li><strong>ContaController:</strong> Endpoints das contas (protegidos)</li>
                </ul>

                <h4>ğŸ’¼ Camada de NegÃ³cio</h4>
                <ul>
                    <li><strong>ContaService:</strong> Regras de negÃ³cio das contas</li>
                    <li><strong>ValidaÃ§Ãµes:</strong> Saldo, CPF Ãºnico, etc.</li>
                </ul>
            </div>

            <!-- IMPLEMENTAÃ‡ÃƒO -->
            <div class="section" id="implementacao">
                <h2>âš™ï¸ 4. IMPLEMENTAÃ‡ÃƒO PASSO A PASSO</h2>
                
                <div class="step">
                    <h3><span class="step-number">1</span>DependÃªncias Maven</h3>
                    <div class="code-block">
&lt;!-- Spring Security --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- JWT Auth0 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.auth0&lt;/groupId&gt;
    &lt;artifactId&gt;java-jwt&lt;/artifactId&gt;
    &lt;version&gt;4.5.0&lt;/version&gt;
&lt;/dependency&gt;
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">2</span>ConfiguraÃ§Ã£o JWT (application.properties)</h3>
                    <div class="code-block">
# Chave secreta para JWT
api.security.token.secret=minha-chave-secreta-jwt-2024

# ConfiguraÃ§Ãµes de seguranÃ§a
spring.jpa.hibernate.ddl-auto=update
spring.flyway.enabled=false
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">3</span>Entidade Usuario</h3>
                    <div class="code-block">
@Entity
@Table(name = "usuarios")
public class Usuario implements UserDetails {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String login;
    private String senha; // BCrypt hash
    
    // ImplementaÃ§Ã£o dos mÃ©todos UserDetails...
}
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">4</span>TokenService - GeraÃ§Ã£o de Tokens</h3>
                    <div class="code-block">
@Service
public class TokenService {
    
    @Value("${api.security.token.secret}")
    private String secret;
    
    public String gerarToken(Usuario usuario) {
        return JWT.create()
            .withIssuer("API Conta BancÃ¡ria")
            .withSubject(usuario.getLogin())
            .withExpiresAt(dataExpiracao())
            .sign(Algorithm.HMAC256(secret));
    }
    
    private Instant dataExpiracao() {
        return LocalDateTime.now()
            .plusHours(2)
            .toInstant(ZoneOffset.of("-03:00"));
    }
}
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">5</span>SecurityFilter - ValidaÃ§Ã£o de Tokens</h3>
                    <div class="code-block">
@Component
public class SecurityFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                  HttpServletResponse response,
                                  FilterChain filterChain) {
        
        var token = recuperarToken(request);
        
        if (token != null) {
            var subject = tokenService.getSubject(token);
            var usuario = usuarioRepository.findByLogin(subject);
            
            var authentication = new UsernamePasswordAuthenticationToken(
                usuario, null, usuario.getAuthorities()
            );
            
            SecurityContextHolder.getContext().setAuthentication(authentication);
        }
        
        filterChain.doFilter(request, response);
    }
}
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">6</span>Controller de AutenticaÃ§Ã£o</h3>
                    <div class="code-block">
@RestController
@RequestMapping("/login")
public class AutenticacaoController {
    
    @PostMapping
    public ResponseEntity&lt;DadosTokenJWT&gt; login(@RequestBody @Valid DadosAutenticacao dados) {
        
        var authToken = new UsernamePasswordAuthenticationToken(
            dados.login(), dados.senha()
        );
        
        var authentication = authenticationManager.authenticate(authToken);
        var usuario = (Usuario) authentication.getPrincipal();
        var tokenJWT = tokenService.gerarToken(usuario);
        
        return ResponseEntity.ok(new DadosTokenJWT(tokenJWT));
    }
}
                    </div>
                </div>
            </div>

            <!-- TESTES INSOMNIA -->
            <div class="section" id="testes-insomnia">
                <h2>ğŸ§ª 5. TESTES COM INSOMNIA</h2>
                
                <h3>ConfiguraÃ§Ã£o do Insomnia</h3>
                <div class="info-box">
                    <p><strong>Base URL:</strong> http://127.0.0.1:8080</p>
                    <p><strong>Content-Type:</strong> application/json</p>
                </div>

                <div class="step">
                    <h3><span class="step-number">1</span>Teste de Login (POST)</h3>
                    
                    <h4>Endpoint:</h4>
                    <div class="code-block">
POST http://127.0.0.1:8080/login
Content-Type: application/json
                    </div>

                    <h4>Body (JSON):</h4>
                    <div class="code-block">
{
  "login": "admin",
  "senha": "123456"
}
                    </div>

                    <h4>Resposta Esperada (200 OK):</h4>
                    <div class="code-block">
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJBUEkgQ29udGEgQmFuY8OhcmlhIiwic3ViIjoiYWRtaW4iLCJleHAiOjE2NDI2OTM2MDB9.signature"
}
                    </div>

                    <div class="success-box">
                        <strong>âœ… Sucesso:</strong> Copie o token retornado para usar nos prÃ³ximos testes
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">2</span>Teste sem Token (GET) - Deve dar 401</h3>
                    
                    <h4>Endpoint:</h4>
                    <div class="code-block">
GET http://127.0.0.1:8080/contas
                    </div>

                    <h4>Resposta Esperada (401 Unauthorized):</h4>
                    <div class="code-block">
{
  "codigo": "FALHA_AUTENTICACAO",
  "titulo": "Falha na autenticaÃ§Ã£o",
  "detalhe": "Token invÃ¡lido, expirado ou ausente. FaÃ§a login novamente"
}
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">3</span>Teste com Token (GET) - Deve funcionar</h3>
                    
                    <h4>Endpoint:</h4>
                    <div class="code-block">
GET http://127.0.0.1:8080/contas
Authorization: Bearer SEU_TOKEN_AQUI
                    </div>

                    <h4>Resposta Esperada (200 OK):</h4>
                    <div class="code-block">
[
  {
    "id": 1,
    "titular": "JoÃ£o Silva (CPF: 12345678901)",
    "saldo": 1500.00,
    "idCliente": 1
  },
  {
    "id": 2,
    "titular": "Maria Santos (CPF: 98765432100)",
    "saldo": 2300.50,
    "idCliente": 2
  }
]
                    </div>
                </div>

                <div class="step">
                    <h3><span class="step-number">4</span>Teste de CriaÃ§Ã£o de Conta (POST)</h3>
                    
                    <h4>Endpoint:</h4>
                    <div class="code-block">
POST http://127.0.0.1:8080/contas
Authorization: Bearer SEU_TOKEN_AQUI
Content-Type: application/json
                    </div>

                    <h4>Body (JSON):</h4>
                    <div class="code-block">
{
  "nome": "Carlos Oliveira",
  "cpf": "11122233344",
  "saldo": 1000.00
}
                    </div>

                    <h4>Resposta Esperada (201 Created):</h4>
                    <div class="code-block">
{
  "id": 5,
  "titular": "Carlos Oliveira (CPF: 11122233344)",
  "saldo": 1000.00,
  "idCliente": 5
}
                    </div>
                </div>

                <h3>CenÃ¡rios de Erro para Testar</h3>
                
                <div class="warning-box">
                    <h4>ğŸ”´ Login com credenciais invÃ¡lidas:</h4>
                    <div class="code-block">
POST /login
{
  "login": "admin",
  "senha": "senhaerrada"
}

Resposta: 401 Unauthorized
{
  "codigo": "CREDENCIAIS_INVALIDAS",
  "titulo": "Login ou senha incorretos",
  "detalhe": "Verifique suas credenciais e tente novamente"
}
                    </div>
                </div>

                <div class="warning-box">
                    <h4>ğŸ”´ CPF duplicado:</h4>
                    <div class="code-block">
POST /contas (com token vÃ¡lido)
{
  "nome": "Teste",
  "cpf": "12345678901",  // CPF jÃ¡ existe
  "saldo": 500.00
}

Resposta: 400 Bad Request
{
  "codigo": "CPF_DUPLICADO",
  "titulo": "CPF jÃ¡ estÃ¡ cadastrado no sistema",
  "detalhe": "CPF jÃ¡ cadastrado: 12345678901"
}
                    </div>
                </div>
            </div>

            <!-- TRATAMENTO DE ERROS -->
            <div class="section" id="tratamento-erros">
                <h2>ğŸ›¡ï¸ 6. TRATAMENTO DE ERROS</h2>
                
                <h3>Classe TratadorDeErros</h3>
                <p>Implementamos um tratador global de erros usando <code>@RestControllerAdvice</code> que intercepta todas as exceÃ§Ãµes e retorna respostas JSON padronizadas.</p>

                <h3>Tipos de Erros Tratados</h3>
                
                <div class="step">
                    <h4>ğŸ”´ 401 Unauthorized - Credenciais InvÃ¡lidas</h4>
                    <div class="code-block">
@ExceptionHandler(BadCredentialsException.class)
public ResponseEntity&lt;DadosErroResposta&gt; tratarErroBadCredentials() {
    var erro = new DadosErroResposta(
        "CREDENCIAIS_INVALIDAS",
        "Login ou senha incorretos",
        "Verifique suas credenciais e tente novamente"
    );
    return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(erro);
}
                    </div>
                </div>

                <div class="step">
                    <h4>ğŸ”´ 400 Bad Request - ValidaÃ§Ã£o de Campos</h4>
                    <div class="code-block">
@ExceptionHandler(MethodArgumentNotValidException.class)
public ResponseEntity&lt;DadosErroValidacao&gt; tratarErro400(MethodArgumentNotValidException ex) {
    var erros = ex.getFieldErrors();
    var dadosErro = new DadosErroValidacao(
        "DADOS_INVALIDOS",
        "Os dados enviados sÃ£o invÃ¡lidos",
        erros.stream().map(DadosErroValidacaoCampo::new).toList()
    );
    return ResponseEntity.badRequest().body(dadosErro);
}
                    </div>
                </div>

                <div class="step">
                    <h4>ğŸ”´ 404 Not Found - Recurso NÃ£o Encontrado</h4>
                    <div class="code-block">
@ExceptionHandler(EntityNotFoundException.class)
public ResponseEntity&lt;DadosErroResposta&gt; tratarErro404() {
    var erro = new DadosErroResposta(
        "RECURSO_NAO_ENCONTRADO",
        "O recurso solicitado nÃ£o foi encontrado",
        "Verifique o ID informado e tente novamente"
    );
    return ResponseEntity.status(HttpStatus.NOT_FOUND).body(erro);
}
                    </div>
                </div>

                <h3>Estrutura das Respostas de Erro</h3>
                <div class="code-block">
// Erro simples
{
  "codigo": "CREDENCIAIS_INVALIDAS",
  "titulo": "Login ou senha incorretos", 
  "detalhe": "Verifique suas credenciais e tente novamente"
}

// Erro de validaÃ§Ã£o (mÃºltiplos campos)
{
  "codigo": "DADOS_INVALIDOS",
  "titulo": "Os dados enviados sÃ£o invÃ¡lidos",
  "erros": [
    {
      "campo": "nome",
      "mensagem": "Nome Ã© obrigatÃ³rio"
    },
    {
      "campo": "cpf", 
      "mensagem": "CPF deve ter 11 dÃ­gitos"
    }
  ]
}
                </div>
            </div>

            <!-- SEGURANÃ‡A -->
            <div class="section" id="seguranca">
                <h2>ğŸ”’ 7. ASPECTOS DE SEGURANÃ‡A</h2>
                
                <h3>Medidas de SeguranÃ§a Implementadas</h3>
                
                <ul class="checklist">
                    <li><strong>Senhas Criptografadas:</strong> BCrypt com salt automÃ¡tico</li>
                    <li><strong>Tokens com ExpiraÃ§Ã£o:</strong> 2 horas de validade</li>
                    <li><strong>Stateless Authentication:</strong> Sem sessÃµes no servidor</li>
                    <li><strong>CORS Configurado:</strong> Controle de origens permitidas</li>
                    <li><strong>CSRF Desabilitado:</strong> Apropriado para APIs stateless</li>
                    <li><strong>ValidaÃ§Ã£o de Entrada:</strong> Bean Validation em todos os endpoints</li>
                    <li><strong>Tratamento de Erros:</strong> NÃ£o exposiÃ§Ã£o de informaÃ§Ãµes sensÃ­veis</li>
                </ul>

                <h3>ConfiguraÃ§Ãµes de SeguranÃ§a</h3>
                <div class="code-block">
@Configuration
@EnableWebSecurity
public class SecurityConfigurations {
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) {
        return http
            .csrf(csrf -> csrf.disable())  // Desabilita CSRF para JWT
            .sessionManagement(sm -> sm.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(req -> {
                req.requestMatchers(HttpMethod.POST, "/login").permitAll();
                req.requestMatchers("/login.html", "/login.css", "/auth.js").permitAll();
                req.anyRequest().authenticated();  // Todas as outras rotas protegidas
            })
            .addFilterBefore(securityFilter, UsernamePasswordAuthenticationFilter.class)
            .build();
    }
}
                </div>

                <h3>Boas PrÃ¡ticas de SeguranÃ§a</h3>
                
                <div class="warning-box">
                    <h4>âš ï¸ Em ProduÃ§Ã£o:</h4>
                    <ul>
                        <li>Use chave JWT complexa e armazene em variÃ¡vel de ambiente</li>
                        <li>Configure HTTPS obrigatÃ³rio</li>
                        <li>Implemente rate limiting para login</li>
                        <li>Use refresh tokens para renovaÃ§Ã£o automÃ¡tica</li>
                        <li>Configure logs de auditoria</li>
                        <li>Implemente bloqueio por tentativas de login</li>
                    </ul>
                </div>

                <h3>Fluxo de SeguranÃ§a Completo</h3>
                <div class="flow-diagram">
1. ğŸ” USUÃRIO envia credenciais
   â†“
2. ğŸ›¡ï¸ SPRING SECURITY valida com BCrypt
   â†“
3. âœ… Se vÃ¡lido: TokenService gera JWT
   â†“
4. ğŸ“± CLIENTE armazena token no localStorage
   â†“
5. ğŸ”„ CLIENTE envia token no header Authorization
   â†“
6. ğŸ›¡ï¸ SecurityFilter intercepta e valida token
   â†“
7. âœ… Se vÃ¡lido: permite acesso ao recurso
   â†“
8. âŒ Se invÃ¡lido: retorna 401 Unauthorized
                </div>

                <h3>Monitoramento e Logs</h3>
                <div class="info-box">
                    <p>O sistema registra automaticamente:</p>
                    <ul>
                        <li>Tentativas de login (sucesso e falha)</li>
                        <li>Tokens gerados e validados</li>
                        <li>Acessos a recursos protegidos</li>
                        <li>Erros de autenticaÃ§Ã£o e autorizaÃ§Ã£o</li>
                    </ul>
                </div>
            </div>

            <!-- CONCLUSÃƒO -->
            <div class="section">
                <h2>ğŸ¯ CONCLUSÃƒO</h2>
                
                <p>Este projeto demonstra uma implementaÃ§Ã£o completa e segura de autenticaÃ§Ã£o JWT em Spring Boot, seguindo as melhores prÃ¡ticas de seguranÃ§a e arquitetura de software.</p>

                <div class="success-box">
                    <h3>âœ… Objetivos AlcanÃ§ados:</h3>
                    <ul class="checklist">
                        <li>Sistema de autenticaÃ§Ã£o JWT funcional</li>
                        <li>ProteÃ§Ã£o de rotas da API</li>
                        <li>Interface web responsiva</li>
                        <li>Tratamento robusto de erros</li>
                        <li>CÃ³digo bem documentado e comentado</li>
                        <li>Testes funcionais validados</li>
                    </ul>
                </div>

                <div class="info-box">
                    <h3>ğŸ“š Conceitos Aprendidos:</h3>
                    <ul>
                        <li>Funcionamento interno do JWT</li>
                        <li>Spring Security 6 com configuraÃ§Ã£o moderna</li>
                        <li>Filtros customizados de seguranÃ§a</li>
                        <li>Criptografia de senhas com BCrypt</li>
                        <li>Tratamento global de exceÃ§Ãµes</li>
                        <li>Arquitetura em camadas</li>
                        <li>Testes de API com Insomnia</li>
                    </ul>
                </div>

                <p><strong>Desenvolvido por:</strong> Guilherme - Dataprev</p>
                <p><strong>Tecnologia:</strong> Spring Boot 3.3.8 + Spring Security 6 + JWT</p>
                <p><strong>Data:</strong> Janeiro 2026</p>
            </div>
        </div>
    </div>
</body>
</html>